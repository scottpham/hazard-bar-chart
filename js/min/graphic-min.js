function draw_graphic(){if(Modernizr.svg){$graphic.empty();var t=$graphic.width();render(t),window.onresize=draw_graphic}}function render(t){function e(t){mobileThreshold>t?(console.log("mobileThreshold reached"),r.fontSize="13px",margin.left=100):(r.fontSize=null,margin.left=135)}function n(t){return t[a]=+t[a],t}var a=$("#dropdown").val();console.log("dropdown = "+a);var r={};e(t);var l=Math.ceil(t*aspect_height/aspect_width)-margin.top-margin.bottom;console.log("height = "+l),l>330?l=330:null;var o=d3.scale.linear().range([0,t-margin.left-margin.right]),i=d3.scale.ordinal().rangeRoundBands([0,l],.15),c=d3.format("0.2f"),s=d3.svg.axis().scale(o).tickFormat("").orient("top"),d=d3.svg.axis().scale(i).orient("left"),u=d3.select("#graphic").append("svg").attr("width",t).attr("height",l+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),g=d3.select("#graphic").append("div").attr("class","tooltip").style("opacity",0),f=function(){return d3.svg.axis().scale(o).orient("bottom")};console.log(a),d3.csv("spills.csv",n,function(t,e){o.domain([0,d3.max(e,function(t){return 158})]),i.domain(e.sort(function(t,e){return e[a]-t[a]}).map(function(t){return t.county})),u.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",0).attr("fill","#bf600a").attr("width",function(t){return o(t[a])}).attr("y",function(t){return i(t.county)}).attr("height",i.rangeBand()),u.selectAll(".label").data(e).enter().append("text").attr("class","label").text(function(t){return t?t[a]:"0"}).attr("y",function(t){return i(t.county)+i.rangeBand()/2}).attr("x",function(t){return o(t[a])+3}).attr("dy",3),u.append("g").attr("transform","translate(0,0)").attr("class","y axis").call(d).attr("text-anchor","end"),u.selectAll(".tick").style("font-size",r.fontSize),u.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(s)}),d3.select("#dropdown").on("change",function(){a=this.value,d3.csv("spills.csv",n,function(t,e){function n(){s.selectAll(".bar").attr("y",function(t){return f(t.county)}).each(r).delay(g)}function r(){s.selectAll(".bar").attr("width",function(t){return o(t[a])}).each(l).delay(g)}function l(){s.selectAll(".label").attr("x",function(t){return o(t[a])+3}).text(function(t){return t[a]}).attr("y",function(t){return f(t.county)+i.rangeBand()/2}).each(c).delay(g)}function c(){s.selectAll(".y.axis").call(d).selectAll(".tick").delay(g)}var s=u.transition().duration(500),g=function(t,e){return 150*e},f=i.domain(e.sort(function(t,e){return e[a]-t[a]}).map(function(t){return t.county}));n()})})}var mobileThreshold=500,aspect_width=16,aspect_height=9,tickNumber=10,margin={top:30,right:40,bottom:20,left:135},$graphic=$("#graphic"),colors={red1:"#6C2315",red2:"#A23520",red3:"#D8472B",red4:"#E27560",red5:"#ECA395",red6:"#F5D1CA",orange1:"#714616",orange2:"#AA6A21",orange3:"#E38D2C",orange4:"#EAAA61",orange5:"#F1C696",orange6:"#F8E2CA",yellow1:"#77631B",yellow2:"#B39429",yellow3:"#EFC637",yellow4:"#F3D469",yellow5:"#F7E39B",yellow6:"#FBF1CD",teal1:"#0B403F",teal2:"#11605E",teal3:"#17807E",teal4:"#51A09E",teal5:"#8BC0BF",teal6:"#C5DFDF",blue1:"#28556F",blue2:"#3D7FA6",blue3:"#51AADE",blue4:"#7DBFE6",blue5:"#A8D5EF",blue6:"#D3EAF7"};$(window).load(function(){draw_graphic()});